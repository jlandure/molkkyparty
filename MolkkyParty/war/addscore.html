<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>MolkkyParty</title>
    <meta name="description" content="MolkkyParty">
    <meta name="author" content="JLE">

    <meta name="viewport" content="width=device-width">

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <style>
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
    </style>
    <link rel="stylesheet" href="css/bootstrap.css">
</head>
<body>
    <!--[if lt IE 7]><p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]-->

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
 
          <a class="brand" href="#">MolkkyParty - JS</a>
              <ul class="nav">
				<li class="dropdown">
					<a class="dropdown-toggle" data-toggle="dropdown" href="#">
					Joueurs
					<b class="caret"></b>
					</a>
					<ul class="dropdown-menu">
						<li>
							<a href="#">Ajouter un joueur</a>
						</li>
						<li>
							<a href="group.html">Statistiques</a>
						</li>
					</ul>
				</li>
				<li class="active"><a href="#">Matchs</a></li>
				<li><a href="#">Classement</a></li>
				<li><a href="#">Bareme</a></li>
				</ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="row">
        
          <h1>Nouveau Match</h1>
          
          
            <p id="spinner"></p>
          			  
					  <div class="span8">
						<form class="form-horizontal">
							<fieldset>
							  <div class="control-group">
								
								<div class="controls">
									<div class="input-prepend input-append">
										<span class="add-on">Saisir un match avec </span>
										<select id='nbplayers' style="width:50px">
											<option value="1">1</option>
											<option value="2">2</option>
											<option value="3">3</option>
											<option value="4">4</option>
											<option value="5">5</option>
											<option value="6">6</option>
											<option value="7">7</option>
											<option value="8">8</option>
											<option value="9">9</option>
											<option value="10">10</option>
										</select>
										<span class="add-on">joueurs</span>
										<button id="add_players" class="btn" type="button">Go!</button>
									</div>
								</div>
							  </div>
							 </fieldset>
						</form>
					  
						<h3>
						<form id="match_form" class="well form-inline">
							
							
						</form>
						</h3>
					</div>

				<p id="spinner"></p>
				<div align="right">
					<button id="saveScore" class="btn btn-primary">Enregistrer</button>
				</div>
			
        
		<div id="alert_content">
		</div>
		
       
      </div>

      <hr>

      <footer>
        <p>
          <img src="https://developers.google.com/images/developers-logo.png" class="quimby_search_image">  &copy; Google 2012

        </p>
      </footer>

    </div> <!-- /container -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/libs/jquery-1.7.2.min.js"><\/script>')</script>

    <script src="js/libs/bootstrap/bootstrap.min.js"></script>

	
	<script type="text/javascript">	
	
	
	$("#add_players").click(function() {
		//remplir le formulaire d'un joueur
		$.ajax({
		  url: "http://localhost:8888/_ah/api/molkkyparty/v1/group/1/users",
		  dataType: 'json',
		  contentType: 'application/json',
		  type: "GET",
		  success: function(data) {
			alert('appel ajax json');
			preFillUserScore(data);
		  },
		  error: function(xhr, ajaxOptions, thrownError) {
			console.error("Beer list error: " + xhr.status) + " err: " + thrownError;
			$('<h3/>', {
				html: "Could not load score sheet"
			  }).appendTo('#match_form');
		  }
		 
		});
	});
	
	
	$("#saveScore").click(function() {
		var apiUrl = "http://localhost:8888/_ah/api/molkkyparty/v1/score";

			alert("Score to save.");
			console.log("Going to save the score...");
			var features = {};

			// extract all the info from the form's fields
			features['login']=$('#login').val();
			features['name']=$('#username').val();
			features['email']=$('#usermail').val();
			features['idGroup']=$('#usergroup').val();;
			
			$.ajax({
			  url: apiUrl,
			  dataType: 'json',
			  contentType: 'application/json',
			  type: "POST",
			  data: JSON.stringify(features),
			  success: function(data) {
				alert(data);
			  },
			  error: function(xhr, ajaxOptions, thrownError) {
				console.error("Beer list error: " + xhr.status) + " err: " + thrownError;
				$('<h3/>', {
					html: "Could not find beers"
				  }).appendTo('#first_player');
			  }
 
			});
	});
	

function preFillUserScore(data) {
	
  if (data && data.items) { 
	
	
	var tmp = parseInt($('#nbplayers').val());
	
	for (i=1; i<=tmp+1; i++){ 
		
	}
	
    var users = data.items;
    var items = [];
    
    
	var UserDiv = "<div id='userrow' class='control-group'>";
	var UserFormScore = "<form class='well form-inline'>";
	var UserLabel= "<label>Joueur " + $('#nbplayers').val() + "</label>";
	
	var UserSelect = "<select style='width:100px' id='userselect_" + $('#nbplayers').val() + "'>";
	
	$.each(users, function(key, user) {
	
        UserSelect += "<option value='" + user.id + "'>"+user.login+"</option>";
        
	});
	UserSelect += "</select>";

    var UserPointsInput="<input id='userpoints_" + $('#nbplayers').val() + "' type='text' class='input-small' style='width:50px' placeholder='Score'>";
	var UserCrossSelect = "<select style='width:120px' id='crossSelect_" + $('#nbplayers').val() + "'>";
	UserCrossSelect +="<option value='1'>1</option>";
	UserCrossSelect +="<option value='2'>2</option>";
	UserCrossSelect +="<option value='3'>3</option>";
	UserCrossSelect +="<option value='4'>Elimination !</option>";
	UserCrossSelect +="</select>";

	
	
   //items.push(UserDiv + UserFormScore + UserLabel+ UserSelect +UserPointsInput + UserCrossSelect + '</form></div>');
   //items.push(UserFormScore + UserLabel+ UserSelect +UserPointsInput + UserCrossSelect + '</form>');
    
	
	//$(html: items.join('')).appendTo('#first_player');
	$(UserDiv+UserLabel+ UserSelect +UserPointsInput + UserCrossSelect +"</div>").appendTo('#match_form');
	

	
  }
}
	

</script> 

  </body>
</html>